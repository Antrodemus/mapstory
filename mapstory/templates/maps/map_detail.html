{% extends "maps/map_base.html" %}
{% load i18n %}
{% load dialogos_tags %}
{% load agon_ratings_tags %}
{% load url from future %}
{% load base_tags %}
{% load guardian_tags %}
{% load friendly_loader %}
{% friendly_load avatar_tags %}

{% block title %}{{ resource.title }} — {{ block.super }}{% endblock %}

{% block head %}
{% include "maps/map_include.html" %}
{{ block.super }}
<style type="text/css">
div.timeline-highlight-point-decorator {
    width: 10px;
}
#msmap .x-panel-tbar {
    display: none;
}
.gxp-annotations-tip {
    max-width: 200px;
}
.gxp-annotations-tip-body {
    max-height: 375px;
    max-width: 185px;
    overflow-y: auto;
}
body.ms-fullscreen .gxp-annotations-tip-body {
    max-width: 485px;
}
body.ms-fullscreen .gxp-annotations-tip {
    max-width: 500px;
}
</style>
{% endblock %}

{% block body_class %}maps{% endblock %}

{% block body_outer %}
        <!-- dashboard -->
        <section class="slice" id="dashboard">
          <div class="container">
            <div class="row">
              <div class="col-sm-7" style="padding-right:15px;">
                <div id="embedded_map"></div>
                <br>
                <div class="row">
                  <div class="col-sm-2">
                    <a href="{% url "profile_detail" resource.owner.username %}"><img class="thumb img-responsive img-circle" src="{% avatar_url resource.owner %}"/></a>
                  </div>
                  <div class="col-sm-10">
                      <h2 style="font-size:1.5em">{{ resource.owner.first_name }} {{ resource.owner.last_name }}</h2>
                      <hr style="margin:5px">
                      <h2 style="font-size:1.2em;color:gainsboro">
                        <!-- TODO: Add Mapstory messaging functionality, has this been implemented? -->
                        <span style="color:orange">message</span> |
                        {% for social_link in social_links %}
                        {% ifequal social_link "twitter" %}
                          <a href="{{ social_link.url }}"><span style="color:deepskyblue">twitter</span></a> |
                        {% endifequal %}
                        {% ifequal social_link "facebook" %}
                          <a href="{{ social_link.url }}"><span style="color:dodgerblue">facebook</span></a>
                        {% endifequal %}
                        {% endfor %}
                      </h2>
                  </div>
                </div>
                <hr>
                <div class="row">
                  <div class="col-sm-12">
                    <article id="comments" class="tab-pane">
                      {% with resource as obj %}
                        {% include "_comments.html" %}
                      {% endwith %}
                    </article>
                  </div>
                </div>
              </div>
              <div class="col-sm-5" style="padding:15px">
                <div class="row">
                  <div class="col-sm-12">
                    <h2 class="page-title" style="padding-top:10px;">{{ resource.title }}</h2>
                  </div>
                </div>
                <hr style="margin-top:10px;margin-bottom:10px">
                <div class="row">
                  <div class="col-sm-9">
                    {% if resource.region_name_list|length > 0 %}
                    <h3 style="margin-top:0px;margin-bottom:5px;">Region: {{ resource.region_name_list.0 }} <!-- This inequality isn't working for some reason --> {% if resource.region_name_list|length > 1 %} and {{ resource.region_name_list|length|add:"-1" }} more...{% else %} {% endif %}</h3>
                    {% endif %}
                    {% ifequal resource.category None %}
                    {% else %}
                    <h3 style="margin-top:0px;margin-bottom:5px;">Topic: {{ resource.category }}</h3>
                    {% endifequal %}
                    <h3 style="margin-top:0px;margin-bottom:5px;">Tags:</h3>
                    <!-- NOTE: This has some formatting issues; needs to wrap around to a second line nicely -->
                    {% for keyword in resource.keyword_list|slice:"5" %}
                      <span class="label label-default">{{ keyword }}</span>
                    {% endfor %}
                    {% if resource.keyword_list|length > 5 %}
                      <span class="label label-default">{{ resource.keyword_list|length|add:"-5" }} more</span>
                    {% endif %}
                    <!-- Make this into a modal that spawns and lets us add a tag
                    Name of the tag to add:
                    ...that's it I guess
                     -->
                    <a href="#form_add_tag" data-toggle="modal"><span class="label label-default">+ <span contenteditable="true">add</span></span></a>
                    <!-- Modal for adding a tag (WIP) -->
                    {% comment %}
                    <!--
                    {% comment_form resource as form %}
                    <div id="form_add_tag" class="modal-fade" tabindex="-1" role="dialog">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title">{% trans 'Add Tag' %}</h4>
                          </div> -->
                          <!-- TODO: Need to figure out how to add a keyword this way... what should action be?-->
                          <!--
                          <form action="{% comment_target resource %}" method="POST" id="form_post_tag">
                            <div class="modal-body">
                                {% csrf_token %}
                                {{ form|as_bootstrap }}
                            </div>
                            <div class="modal-footer">
                                <button class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Cancel" %}</button>
                                <button id="tag_submit_btn" class="btn btn-primary">{% trans 'Add Tag' %}</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div> -->
                    
                    <!--
                    {% comment_form resource as form %}
                    <div id="form_add_tag" class="modal fade" tabindex="-1" role="dialog">
                        <div class="modal-dialog">
                          <div class="modal-content">
                            <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                              <h4 class="modal-title">{% trans 'Add Comment' %}</h4>
                            </div>
                            <form action="{% comment_target resource %}" method="POST" id="form_post_comment">
                              <div class="modal-body">
                                  {% csrf_token %}
                                  {{ form|as_bootstrap }}
                              </div>
                              <div class="modal-footer">
                                  <button class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Cancel" %}</button>
                                  <button id="comment_submit_btn" class="btn btn-primary">{% trans 'Submit Comment' %}</button>
                              </div>
                            </form>
                          </div>
                        </div>
                    </div>
                  -->
                    {% endcomment %}

                    <hr style="margin-top:15px;margin-bottom:10px">
                    <h3 style="margin-top:0px;margin-bottom:5px;">
                      Rate:
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      
                      <!--
                      Rate:
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                    -->
                      <!--
                      Need to figure out how this is implemented...
                      Looks like an assignment tag probably but the name isn't found any
                      Looks like it uses jquery.raty.js but we want to change the styling of the stars
                      Looks like you can specify staroff and staron
                      It appears this may be from a later version of Geonode?
      <article id="rate" class="tab-pane">
        {% if request.user.is_authenticated %}
        <h4>{% trans "Rate this layer" %}</h4>
        {% user_rating request.user resource "layer" as user_layer_rating %}
        <div id="user_rating" class="category-layer" data-score="{{ user_layer_rating }}"></div>
        {% endif %}        
      </article>
-->
                    </h3>
                  </div>
                  <div class="col-sm-3" style="border-left:1px solid gainsboro">
                  <div style="text-align:right">
                    <a title="" href="{% url "map_viewer" resource.id %}" target="blank">
                      <span style="font-size:1.3em;color:gainsboro">fullscreen</span>
                    </a>
                  </div>
                  <hr style="margin:5px">
                  <div style="text-align:right">
                    <a title="" href="#" target="blank">
                      <span style="font-size:1.3em;color:gainsboro">favorite</span>
                    </a>
                  </div>
                  <hr style="margin:5px">
                  <div style="text-align:right">
                    <a title="" href="#" target="blank">
                      <span style="font-size:1.3em;color:gainsboro">flag</span>
                    </a>
                  </div>
                  <hr style="margin:5px">
                  <div style="text-align:right">
                    <a title="" href="#" target="blank">
                      <span style="font-size:1.3em;color:gainsboro">download</span>
                    </a>
                  </div>
                </div>
                </div>
                <hr style="margin-top:10px;margin-bottom:10px">
                <div id="ShareModal" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Share Settings
            <div class="pull-right">
            <button class="btn btn-xs">
              <span class="close" data-dismiss="modal">x
              </span>
              </button>
            </div>
          </h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm-3">
              <ul class="nav nav-pills nav-stacked">
                <li class="active">
                  <a href="#embed" data-toggle="tab">
                    Embed
                  </a>
                </li>
                <li>
                  <a href="#srvcs" data-toggle="tab">
                    Services
                  </a>
                </li>
              </ul>
            </div>
            <div class="col-sm-9" style="border-left:1px solid gray">
              <div class="tab-content">
                <div class="tab-pane active" id="embed">
                  <div class="row">
                    <div class="col-sm-12">
                      <form class="form" style="margin-bottom: 0;" method="post" action="#" accept-charset="UTF-8"><input name="authenticity_token" type="hidden">
                    <div class="col-sm-8">
                      <div class="form-group">
                            <label for="inputText">Embed Code</label>
                            <input class="form-control" id="inputText" placeholder="<iframe>...</iframe>" type="text">
                          </div>
                    </div>
                    <div class="col-sm-4">
                      <div class="form-group">
                            <label for="inputCategory">Dimensions</label>
                            <select class="form-control" id="inputCategory">
                              <option>Auto</option>
                              <option>240p</option>
                              <option>360p</option>
                              <option>720p</option>
                              <option>1080p</option>
                            </select>
                          </div>
                    </div>
                        </form>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="col-sm-2">
                        <div class="box-quick-link" style="background:dodgerblue">
                                    <a href="#">
                                        <div class="header">
                                          <i class="icon-facebook-1"></i>
                                        </div>
                                    </a>
                                  </div>
                      </div>
                      <div class="col-sm-2">
                        <div class="box-quick-link" style="background:deepskyblue">
                                    <a href="#">
                                        <div class="header">
                                          <i class="icon-twitter-bird"></i>
                                        </div>
                                    </a>
                                  </div>
                      </div>
                      <div class="col-sm-2">
                        <div class="box-quick-link" style="background:red">
                                    <a href="#">
                                        <div class="header">
                                          <i class="icon-gplus-1"></i>
                                        </div>
                                    </a>
                                  </div>
                      </div>
                      <div class="col-sm-2">
                        <div class="box-quick-link" style="background:slategray">
                                    <a href="#">
                                        <div class="header">
                                          <i class="icon-tumblr-1"></i>
                                        </div>
                                    </a>
                                  </div>
                      </div>
                      <div class="col-sm-2">
                        <div class="box-quick-link" style="background:forestgreen">
                                    <a href="#">
                                        <div class="header">
                                          <i class="icon-reddit"></i>
                                        </div>
                                    </a>
                                  </div>
                      </div>
                      <div class="col-sm-2">
                        <div class="box-quick-link" style="background:gold">
                                    <a href="#">
                                        <div class="header">
                                          <i class="icon-at"></i>
                                        </div>
                                    </a>
                                  </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="tab-pane" id="srvcs">
                  <div class="row">
                    <div class="col-sm-12">
                      <form class="form" style="margin-bottom: 0;" method="post" action="#" accept-charset="UTF-8"><input name="authenticity_token" type="hidden">
                        <div class="col-sm-12">
                          <div class="form-group">
                            <label for="inputCategory">Select service</label>
                            <select class="form-control" id="inputCategory">
                              <option>Web Map Service (WMS)</option>
                              <option>Web Map Tile Service (WMTS)</option>
                              <option>Web Feature Service (WFS)</option>
                              <option>Web Coverage Service (WCS)</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-sm-12">
                          <div class="form-group">
                            <label for="inputText">Layer Name</label>
                            <input class="form-control" id="inputText" placeholder="WMS Layer Name" type="text">
                          </div>
                        </div>
                        <div class="col-sm-12">
                          <div class="form-group">
                            <label for="inputText">Server URL </label>
                            <input class="form-control" id="inputText" placeholder="http://wms.com" type="text">
                          </div>
                        </div>
                        <hr>
                        <div class="col-sm-6">
                          <div class="form-group">
                            <label for="inputText">Username </label>
                            <input class="form-control" id="inputText" type="text">
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="form-group">
                            <label for="inputText">Password </label>
                            <input class="form-control" id="inputText" type="text">
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
                <div class="tab-pane" id="wcs">
                  WCS
                </div>
                <div class="tab-pane" id="wfs">
                  WFS
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
                
                <div class="row">
                  <div class="col-sm-12">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#Summary" data-toggle="tab">Summary</a></li>
                        <li><a href="#Metadata" data-toggle="tab">Meta</a></li>
                        <li><a href="#Related" data-toggle="tab">Related</a></li>
                    </ul>
                    <div class="tab-content">
                      <div class="tab-pane active" id="Summary">
                        <div style="max-height:500px; overflow-y:scroll; overflow-x:hidden">
                          Lorem ipsum dolor sit amet, modus utroque patrioque pro et, in zril maiorum voluptatibus nec. Ad augue qualisque mel, pri vidit ferri in. In idque concludaturque pri. Albucius officiis eu mel, meis ipsum summo ei his, dicit nostrud molestiae has ne. Ipsum ignota scripserit sed ne. Ne appareat intellegat liberavisse nec. Ea per impetus insolens mediocrem, nam et augue placerat, duis congue corpora te eos. Mel ei commodo alterum singulis, eu est quod interpretaris. Ad case propriae elaboraret sea. Ex sit accusam forensibus cotidieque, wisi feugiat omittantur vel ex. Id legere aliquid reprehendunt his. Sea etiam movet putent ad, ad ludus doming eam. At mei etiam option efficiendi, ubique feugait suavitate te eos, mollis tractatos pertinacia ei sea. An convenire patrioque signiferumque ius. Omnium impedit te pro. Mea ei minimum salutandi disputationi, animal praesent suscipiantur est id. Graeco aperiri et mei. Saepe nusquam scripserit pro an. Maiestatis deseruisse pri ei, dicam veniam eos te. Ei per iriure efficiendi eloquentiam, nec ne veri doming corrumpit, quem diceret accusamus et mel. Oratio propriae pertinacia per an, no graeco dolorem persecuti mel. Modus corpora eos ei, simul nobis discere ut has. Feugait petentium ex mea, vim quod recteque ex. Nec an mazim deseruisse, ex petentium accusamus abhorreant est, sint decore disputando id sit. Eum id fastidii lobortis, ne semper habemus suavitate sit. Et cum melius sapientem assueverit.
                        </div>
                      </div>
                      <div class="tab-pane" id="Metadata">
                        <table class="table table-condensed table-hover">
                          <tr>
                            <td width="35%">Topic</td>
                            <td width="65%">Wars and Conflicts</td>
                          </tr>
                          <tr>
                            <td width="35%">Language</td>
                            <td width="65%"><i class="flag flag-us"></i> English (US)</td>
                          </tr>
                          <tr>
                            <td width="35%">Data Source</td>
                            <td width="65%">www.mystorylayerdata.com</td>
                          </tr> 
                          <tr>
                            <td width="35%">Data Quality Statement</td>
                            <td width="65%">Lorem ipsum dolor sit amet.</td>
                          </tr>
                          <tr>
                            <td width="35%">Purpose</td>
                            <td width="65%">Lorem ipsum dolor sit amet.</td>
                          </tr>   
                        </table>
                      </div>
                      <div class="tab-pane" id="Related">
                        <div style="max-height:500px; overflow-y:scroll; overflow-x:hidden">
                          <div class="col-sm-12">
                            <div class="row boxFeature">
                              <div class="col-xs-3">
                                <img src="images/portfolio/redlgpng.png" class="img-responsive"/>
                              </div>
                              <div class="col-xs-9">
                                <h3>Media Title</h3>
                                <p>Lorem ipsum dolor sit amet, modus utroque patrioque pro et, in zril maiorum voluptatibus nec.</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-sm-12">
                            <div class="row boxFeature">
                              <div class="col-xs-3">
                                <img src="images/portfolio/yellowlgpng.png" class="img-responsive"/>
                              </div>
                              <div class="col-xs-9">
                                <h3>Media Title</h3>
                                <p>Lorem ipsum dolor sit amet, modus utroque patrioque pro et, in zril maiorum voluptatibus nec.</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-sm-12">
                            <div class="row boxFeature">
                              <div class="col-xs-3">
                                <img src="images/portfolio/yellowlgpng.png" class="img-responsive"/>
                              </div>
                              <div class="col-xs-9">
                                <h3>Media Title</h3>
                                <p>Lorem ipsum dolor sit amet, modus utroque patrioque pro et, in zril maiorum voluptatibus nec.</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-sm-12">
                            <div class="row boxFeature">
                              <div class="col-xs-3">
                                <img src="images/portfolio/yellowlgpng.png" class="img-responsive"/>
                              </div>
                              <div class="col-xs-9">
                                <h3>Media Title</h3>
                                <p>Lorem ipsum dolor sit amet, modus utroque patrioque pro et, in zril maiorum voluptatibus nec.</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-sm-12">
                            <div class="row boxFeature">
                              <div class="col-xs-3">
                                <img src="images/portfolio/yellowlgpng.png" class="img-responsive"/>
                              </div>
                              <div class="col-xs-9">
                                <h3>Media Title</h3>
                                <p>Lorem ipsum dolor sit amet, modus utroque patrioque pro et, in zril maiorum voluptatibus nec.</p>
                              </div>
                            </div>
                          </div>
                    <a class="btn btn-sm btn-block" title="" href="#" target="blank">
                      <span style="font-size:1.2em">load more storylayers</span>
                    </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
{% endblock %}

{% block extra_script %}
{% if SOCIAL_BUTTONS %}
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
{% endif %}
{% if request.user.is_authenticated %}
      {% user_rating_js request.user resource "map" %}
{% else %}
      {% overall_rating resource "map" as the_map_rating %}
{% endif %}
{% include 'rating.html' %}
<script type="text/javascript">
 $(function() {

  {% verbatim %}
  // Publish layer group
  // TODO: this should really not be inside a script tag...
  var $wmsBtn = $(".layer-group .btn"),
      layerGroupElTpl;

  if ($wmsBtn.length > 0) {

    $wmsBtn.on("click", function(event) {
      event.preventDefault();

      $.ajax({
        type: "PUT",
        url: $wmsBtn.attr("href")
      })

        .done(function(data) {
          layerGroupElTpl = "<dt>WMS layer group for local map layers:</dt> \
            <dd><em>{{layerGroupName}}</em> (on <a href='{{ows}}?request=GetCapabilities'>local OWS</a>)</dd>";
          $.each(data, function(key, value) {
            // client-side template hack
            layerGroupElTpl = layerGroupElTpl.replace("{{"+ key + "}}", value);
          });
        })

        .fail(function(){
          layerGroupElTpl = "<dt>Error:</dt> \
            <dd>Layer group could not be created.</dd>";
        })

        .always(function(){
          $(".layer-group dl").html(layerGroupElTpl);
        });

    });
  };
  {% endverbatim %}


 });
{% if SOCIAL_BUTTONS %}
 (function() {
   var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
   po.src = 'https://apis.google.com/js/plusone.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
 })();
{% endif %}
  $("#comment_submit_btn").click(function(event) {
    $.ajax({
      type: "POST",
      url: $("#form_post_comment").attr('action'),
      data: $("#form_post_comment").serialize(),
      success: function() {
        $('#form_post_comment_div').modal('hide');
        $('#comments_section').load(window.location.pathname + ' #comments_section', 
            function(){$(this).children().unwrap()})
      }
    });
    return false;
  });
 
</script>
{% include "_permissions_form_js.html" %}
<script type="text/javascript" src="{{ STATIC_URL}}geonode/js/utils/thumbnail.js"></script>
<script type="text/javascript">
  $('#set_thumbnail').click(function(){
    createMapThumbnail();
    $('#edit-map').modal('toggle');
  });
</script>
 
{% endblock %}