!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),(r.storytools||(r.storytools={})).mapstory=e()}}(function(){return function e(r,t,o){function a(n,p){if(!t[n]){if(!r[n]){var s="function"==typeof require&&require;if(!p&&s)return s(n,!0);if(i)return i(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var u=t[n]={exports:{}};r[n][0].call(u.exports,function(e){var t=r[n][1][e];return a(t?t:e)},u,u.exports,e,r,t,o)}return t[n].exports}for(var i="function"==typeof require&&require,n=0;n<o.length;n++)a(o[n]);return a}({1:[function(e,r,t){t.MapConfigTransformer=e("./MapConfigTransformer")},{"./MapConfigTransformer":2}],2:[function(e,r,t){t.MapConfigTransformer=function(e){var r,t,o=[],a="instant";if(e.tools)for(r=0,t=e.tools.length;t>r;++r){var i=e.tools[r];"gxp_playback"===i.ptype&&i.outputConfig&&"cumulative"===i.outputConfig.playbackMode&&(a="cumulative")}for(r=0,t=e.map.layers.length;t>r;++r){var n=e.map.layers[r];if(n.visibility===!0){var p=e.sources[n.source],s={visibility:n.visibility,group:n.group};if("gxp_mapquestsource"===p.ptype)s.type="MapQuest",s.layer="naip"===n.name?"sat":"osm",s.title=n.title,o.push(s);else if("gxp_mapboxsource"===p.ptype)s.type="MapBox",s.name=n.name,s.title=n.title,o.push(s);else if("gx_olsource"===p.ptype||"gxp_wmscsource"===p.ptype){if(s.type="gx_olsource"===p.ptype?n.type.replace("OpenLayers.Layer.",""):"WMS","OSM"===s.type)s.args&&"Humanitarian OpenStreetMap"===s.args[0]&&(s.type="HOT"),s.title=n.title;else if("WMS"===s.type){var l;if("gx_olsource"===p.ptype&&n.args){l=n.args[2]||{};for(var u in l)l[u].constructor===Array&&(l[u.toUpperCase()]=l[u].join(","),delete l[u]);s.url=n.args[1]}else l={LAYERS:n.name,STYLES:n.styles,TILED:"TRUE",FORMAT:n.format,TRANSPARENT:n.transparent},n.tiled===!1&&(s.singleTile=!0),s.id=n.name,s.name=n.name,s.title=n.title,s.url=p.url?p.url.replace("http://mapstory.org/geoserver/","/geoserver/"):"/geoserver/";if(s.params=l,s.params.VERSION="1.1.1",n.capability){s.latlonBBOX=n.capability.llbbox;var f=storytools.core.time.maps.readCapabilitiesTimeDimensions(n.capability,!0);if(void 0!==f&&(s.times=f),n.capability.tileSets){for(var c in n.capability.tileSets[0].bbox){var y=n.capability.tileSets[0].bbox[c].bbox;s.bbox=y}s.resolutions=n.capability.tileSets[0].resolutions}}}o.push(s)}else window.console&&window.console.warn("Unknown source type in map config: "+p.ptype)}}return{id:e.id,playbackMode:a,map:{center:e.map.center,projection:e.map.projection,zoom:e.map.zoom,layers:o},about:e.about}},t.MapToGXPConfigTransformer=function(e){var r=angular.copy(e);return r.sources={1:{ptype:"gx_olsource"},0:{url:"/geoserver/wms",lazy:!0,restUrl:"/gs/rest",name:"local geoserver",ptype:"gxp_wmscsource"},3:{hidden:!0,ptype:"gxp_mapboxsource"},2:{hidden:!0,ptype:"gxp_mapquestsource"}},r.map.layers.forEach(function(e,t){if("WMS"===e.type){e.type="OpenLayers.Layer.WMS";var o=3+t,a={};a[o]={url:e.url,lazy:!0,restUrl:"/gs/rest",name:e.name,ptype:"gxp_wmscsource"},$.extend(r.sources,a),e.source=o.toString()}}),r}},{}]},{},[1])(1)});